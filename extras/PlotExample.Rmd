---
title: "PlotExample"
author: "Win-Vector LLC"
date: "12/20/2017"
output: github_document
---

```{r setup}
library("ggplot2")
library("cdata")
library("seplyr")

d <- readRDS("metrics.rds")
d$epoch <- seq_len(nrow(d))
print(head(d, n=1))
```


```{r lineplot}
cT <- dplyr::tribble(
  ~measure,               ~training, ~validation,
  "binary_cross_entropy", "loss",    "val_loss",
  "accuracy",              "acc",     "val_acc"
)
print(cT)

dT <- moveValuesToRowsD(
  d,
  controlTable = cT,
  columnsToCopy = "epoch")
print(head(dT))

pick <- dT %.>%
  filter_se(.,
            qe(measure == "binary_cross_entropy")) %.>%
  .$epoch[[which.min(.$validation)]]


ggplot(data = dT, aes(x = epoch,
                      xend = epoch,
                      y = validation,
                      yend = training,
                      ymin = pmin(validation, training),
                      ymax = pmax(validation, training))) +
  geom_segment() +
  geom_point() +
  geom_point(aes(y = training), shape = 3) +
  geom_smooth(se = FALSE) +
  geom_ribbon(alpha=0.2) +
  geom_vline(xintercept = pick, alpha=0.7, color='darkgreen') +
  facet_wrap(~measure, ncol=1, scales = 'free_y') +
  ylab("performance") +
  ggtitle("plotting over-fit as a function of epoch")
```
