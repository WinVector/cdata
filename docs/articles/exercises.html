<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>cdata Exercises • cdata</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="cdata Exercises">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cdata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/cdata.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/blocksrecs.html">Block Records and Row Records</a>
    </li>
    <li>
      <a href="../articles/control_table_keys.html">Control Table Keys</a>
    </li>
    <li>
      <a href="../articles/design.html">Designing Transforms for Data Reshaping with cdata</a>
    </li>
    <li>
      <a href="../articles/exercises.html">cdata Exercises</a>
    </li>
    <li>
      <a href="../articles/general_transform.html">General Data Transforms With cdata</a>
    </li>
    <li>
      <a href="../articles/operators.html">Operators</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://www.win-vector.com/">Sponsor: Win-Vector LLC</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>cdata Exercises</h1>
                        <h4 class="author">John Mount, Win-Vector LLC</h4>
            
            <h4 class="date">2019-04-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/WinVector/cdata/blob/master/vignettes/exercises.Rmd"><code>vignettes/exercises.Rmd</code></a></small>
      <div class="hidden name"><code>exercises.Rmd</code></div>

    </div>

    
    
<p>In <a href="https://winvector.github.io/cdata/articles/exercises.html">this note</a> we are going to use five <a href="https://CRAN.R-project.org/package=tidyr"><code>tidyr</code></a> data transform demonstration examples as exercises to master data layout transforms using the <a href="https://CRAN.R-project.org/package=cdata"><code>cdata</code></a> <a href="https://www.r-project.org"><code>R</code></a> data layout package.</p>
<p>The idea is these are a good cross-section of data layout problems, so they are a good set of examples or exercises to work through.</p>
<p>For each of these examples we will show how to re-layout data using <a href="https://github.com/WinVector/cdata"><code>cdata</code></a>.</p>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Each of these five problems will be solved using the same steps:</p>
<ul>
<li>Get some example data.</li>
<li>Look if either the incoming or outgoing data format is “all data for a record is in a single row” or not, this determines if you later use <code><a href="../reference/rowrecs_to_blocks_spec.html">rowrecs_to_blocks_spec()</a></code> (specifying data moving from single rows to arbitrary block records), <code><a href="../reference/blocks_to_rowrecs_spec.html">blocks_to_rowrecs_spec()</a></code> (specifying data moving from block records to single rows), or <code><a href="../reference/layout_specification.html">layout_specification()</a></code> (a general block record to block record case).</li>
<li>Identify which columns that tell us which sets of rows are records, which we call the “record keys.”</li>
<li>Draw the shape of the incoming record without the record keys.</li>
<li>Draw the shape of the outgoing record without the record keys.</li>
<li>Combine the above information as a one of the above data layout transform specifications.</li>
<li>Print the layout transform to confirm it is what you want.</li>
<li>Apply the layout transform.</li>
</ul>
<p>This may seem like a lot of steps, but it is only because we are taking the problems very slowly. The thing to note is there is hopefully not a lot of additional problem solving to apply the <code>cdata</code> methodology. Usually when you need to transform data you are in the middle of some other more important task, so you want delegate the details of how the layout transform is implemented. In <code>cdata</code> the user only specifies the data layout transform, and implementation is left to the <code>cdata</code> package. With <code>cdata</code> the user is not asked to perform additional puzzle solving to guess sequence of operators that may implement the desired data layout transform. The <code>cdata</code> solution pattern is always the same, which can help in mastering it.</p>
<p>With <code>cdata</code> record layout transforms are simple <code>R</code> objects with detailed <code><a href="https://www.rdocumentation.org/packages/base/topics/print">print()</a></code> methods- so they are convenient to save re-used later.</p>
<p>We will work some examples with the hope that practice brings familiarity. The examples for this note are all of the demo-examples from <a href="https://github.com/tidyverse/tidyr/tree/master/demo">tidyr/demo/</a>.</p>
</div>
<div id="example-1" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example 1</h2>
<p>(From: <a href="https://github.com/tidyverse/tidyr/blob/master/demo/dadmom.R" class="uri">https://github.com/tidyverse/tidyr/blob/master/demo/dadmom.R</a>.)</p>
<p>Full data not available, as the link is dead. From <a href="https://stats.idre.ucla.edu/stata/modules/reshaping-data-wide-to-long/" class="uri">https://stats.idre.ucla.edu/stata/modules/reshaping-data-wide-to-long/</a> we can get the following similar data extract. From this source we can extract the question:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># convert from this format</span>
dadmomw &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/build_frame">build_frame</a></span>(
   <span class="st">"famid"</span>  , <span class="st">"named"</span>, <span class="st">"incd"</span>, <span class="st">"namem"</span>, <span class="st">"incm"</span> <span class="op">|</span>
<span class="st">     </span><span class="dv">1</span>      , <span class="st">"Bill"</span> , <span class="dv">30000</span> , <span class="st">"Bess"</span> , <span class="dv">15000</span>  <span class="op">|</span>
<span class="st">     </span><span class="dv">2</span>      , <span class="st">"Art"</span>  , <span class="dv">22000</span> , <span class="st">"Amy"</span>  , <span class="dv">18000</span>  <span class="op">|</span>
<span class="st">     </span><span class="dv">3</span>      , <span class="st">"Paul"</span> , <span class="dv">25000</span> , <span class="st">"Pat"</span>  , <span class="dv">50000</span>  )

<span class="co"># to this format</span>
dadmomt &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/build_frame">build_frame</a></span>(
   <span class="st">"famid"</span>  , <span class="st">"dadmom"</span>, <span class="st">"name"</span>, <span class="st">"inc"</span> <span class="op">|</span>
<span class="st">     </span><span class="dv">1</span>      , <span class="st">"d"</span>     , <span class="st">"Bill"</span>, <span class="dv">30000</span> <span class="op">|</span>
<span class="st">     </span><span class="dv">1</span>      , <span class="st">"m"</span>     , <span class="st">"Bess"</span>, <span class="dv">15000</span> <span class="op">|</span>
<span class="st">     </span><span class="dv">2</span>      , <span class="st">"d"</span>     , <span class="st">"Art"</span> , <span class="dv">22000</span> <span class="op">|</span>
<span class="st">     </span><span class="dv">2</span>      , <span class="st">"m"</span>     , <span class="st">"Amy"</span> , <span class="dv">18000</span> <span class="op">|</span>
<span class="st">     </span><span class="dv">3</span>      , <span class="st">"d"</span>     , <span class="st">"Paul"</span>, <span class="dv">25000</span> <span class="op">|</span>
<span class="st">     </span><span class="dv">3</span>      , <span class="st">"m"</span>     , <span class="st">"Pat"</span> , <span class="dv">50000</span> )</code></pre></div>
<p>The <code>cdata</code> solution is given here, notice the incoming record is a single row so we don’t have to specify it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"cdata"</span>)

<span class="co"># how to find records</span>
recordKeys &lt;-<span class="st"> "famid"</span>

<span class="co"># specify the outgoing record shape</span>
outgoing_record &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/qchar_frame">qchar_frame</a></span>(
   <span class="st">"dadmom"</span>  , <span class="st">"name"</span>, <span class="st">"inc"</span> <span class="op">|</span>
<span class="st">     "d"</span>     , named , incd <span class="op">|</span>
<span class="st">     "m"</span>     , namem , incm )

<span class="co"># put it all together into a layout</span>
layout &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rowrecs_to_blocks_spec.html">rowrecs_to_blocks_spec</a></span>(
  outgoing_record,
  <span class="dt">recordKeys =</span> recordKeys)

<span class="co"># confirm we have the right layout</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(layout)
<span class="co">#&gt; {</span>
<span class="co">#&gt;  row_record &lt;- wrapr::qchar_frame(</span>
<span class="co">#&gt;    "famid"  , "named", "namem", "incd", "incm" |</span>
<span class="co">#&gt;      .      , named  , namem  , incd  , incm   )</span>
<span class="co">#&gt;  row_keys &lt;- c('famid')</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  # becomes</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  block_record &lt;- wrapr::qchar_frame(</span>
<span class="co">#&gt;    "famid"  , "dadmom", "name", "inc" |</span>
<span class="co">#&gt;      .      , "d"     , named , incd  |</span>
<span class="co">#&gt;      .      , "m"     , namem , incm  )</span>
<span class="co">#&gt;  block_keys &lt;- c('famid', 'dadmom')</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  # args: c(checkNames = TRUE, checkKeys = FALSE, strict = FALSE, allow_rqdatatable = TRUE)</span>
<span class="co">#&gt; }</span>

<span class="co"># apply the layout</span>
dadmomw <span class="op">%.&gt;%</span><span class="st"> </span>
<span class="st">  </span>layout <span class="op">%.&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(.)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">famid</th>
<th align="left">dadmom</th>
<th align="left">name</th>
<th align="right">inc</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">d</td>
<td align="left">Bill</td>
<td align="right">30000</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">m</td>
<td align="left">Bess</td>
<td align="right">15000</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">d</td>
<td align="left">Art</td>
<td align="right">22000</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">m</td>
<td align="left">Amy</td>
<td align="right">18000</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">d</td>
<td align="left">Paul</td>
<td align="right">25000</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">m</td>
<td align="left">Pat</td>
<td align="right">50000</td>
</tr>
</tbody>
</table>
<p>Notice we take the column names from the incoming row-record and use them as cell-names in the outgoing record; this is how we show where the data goes.</p>
<p>Also notice the <code><a href="https://www.rdocumentation.org/packages/base/topics/print">print()</a></code> method fully documents what columns are expected and the intent of the data layout transform. The <code><a href="https://www.rdocumentation.org/packages/base/topics/print">print()</a></code> method is using a convention that quoted entities are values we know (values that specify column names, or keys that describe the interior of the block record structure), and un-quoted entities are values we expect to be in the record or “dot” for row-keys (keys that specify which sets of rows are in the same block record).</p>
<p>(Note: the original “<code>tidyr</code>” solution may have been on different data, or at least appears to not work on the above data. As the <code>tidyr</code> does not have a data layout transform print method, we can’t confirm if we have the correct data for the <code>tidyr</code> example.)</p>
</div>
<div id="example-2" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2" class="anchor"></a>Example 2</h2>
<p>(From: <a href="http://stackoverflow.com/questions/15668870/" class="uri">http://stackoverflow.com/questions/15668870/</a>, <a href="http://stackoverflow.com/questions/15668870/">https://github.com/tidyverse/tidyr/blob/master/demo/so-15668870.R</a>.)</p>
<p>The original question was:</p>
<pre><code>I want to reshape a wide format dataset that has multiple tests which are measured at 3 time points:

   ID   Test Year   Fall Spring Winter
    1   1   2008    15      16      19
    1   1   2009    12      13      27
    1   2   2008    22      22      24
    1   2   2009    10      14      20
 ...

into a data set that separates the tests by column but converts the measurement time into long format, for each of the new columns like this:

    ID  Year    Time        Test1 Test2
    1   2008    Fall        15      22
    1   2008    Spring      16      22
    1   2008    Winter      19      24
    1   2009    Fall        12      10
    1   2009    Spring      13      14
    1   2009    Winter      27      20
 ...

I have unsuccessfully tried to use reshape and melt. Existing posts address transforming to single column outcome.</code></pre>
<p>To solve this using <code>cdata</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"cdata"</span>)

<span class="co"># how to find records</span>
recordKeys &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"ID"</span>, <span class="st">"Year"</span>)

<span class="co"># specify the incoming record shape</span>
incoming_record &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/qchar_frame">qchar_frame</a></span>(
  <span class="st">"Test"</span>  , <span class="st">"Fall"</span>, <span class="st">"Spring"</span>, <span class="st">"Winter"</span> <span class="op">|</span>
<span class="st">    "1"</span>   , F1    , S1      , W1       <span class="op">|</span>
<span class="st">    "2"</span>   , F2    , S2      , W2       )

<span class="co"># specify the outgoing record shape</span>
outgoing_record &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/qchar_frame">qchar_frame</a></span>(
  <span class="st">"Semester"</span> , <span class="st">"Test1"</span>, <span class="st">"Test2"</span> <span class="op">|</span>
<span class="st">    "Fall"</span>   , F1,      F2      <span class="op">|</span>
<span class="st">    "Spring"</span> , S1,      S2      <span class="op">|</span>
<span class="st">    "Winter"</span> , W1,      W2      )

<span class="co"># put it all together into a layout</span>
layout &lt;-<span class="st"> </span><span class="kw"><a href="../reference/layout_specification.html">layout_specification</a></span>(
  <span class="dt">incoming_shape =</span> incoming_record,
  <span class="dt">outgoing_shape =</span> outgoing_record,
  <span class="dt">recordKeys =</span> recordKeys)

<span class="co"># confirm we have the right layout</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(layout)
<span class="co">#&gt; {</span>
<span class="co">#&gt;  in_record &lt;- wrapr::qchar_frame(</span>
<span class="co">#&gt;    "ID"  , "Year", "Test", "Fall", "Spring", "Winter" |</span>
<span class="co">#&gt;      .   , .     , "1"   , F1    , S1      , W1       |</span>
<span class="co">#&gt;      .   , .     , "2"   , F2    , S2      , W2       )</span>
<span class="co">#&gt;  in_keys &lt;- c('ID', 'Year', 'Test')</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  # becomes</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  out_record &lt;- wrapr::qchar_frame(</span>
<span class="co">#&gt;    "ID"  , "Year", "Semester", "Test1", "Test2" |</span>
<span class="co">#&gt;      .   , .     , "Fall"    , F1     , F2      |</span>
<span class="co">#&gt;      .   , .     , "Spring"  , S1     , S2      |</span>
<span class="co">#&gt;      .   , .     , "Winter"  , W1     , W2      )</span>
<span class="co">#&gt;  out_keys &lt;- c('ID', 'Year', 'Semester')</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  # args: c(checkNames = TRUE, checkKeys = TRUE, strict = FALSE, allow_rqdatatable = FALSE)</span>
<span class="co">#&gt; }</span>

<span class="co"># example data</span>
grades &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/build_frame">build_frame</a></span>(
   <span class="st">"ID"</span>  , <span class="st">"Test"</span>, <span class="st">"Year"</span>, <span class="st">"Fall"</span>, <span class="st">"Spring"</span>, <span class="st">"Winter"</span> <span class="op">|</span>
<span class="st">     </span><span class="dv">1</span>   , <span class="dv">1</span>     , <span class="dv">2008</span>  , <span class="dv">15</span>    , <span class="dv">16</span>      , <span class="dv">19</span>       <span class="op">|</span>
<span class="st">     </span><span class="dv">1</span>   , <span class="dv">1</span>     , <span class="dv">2009</span>  , <span class="dv">12</span>    , <span class="dv">13</span>      , <span class="dv">27</span>       <span class="op">|</span>
<span class="st">     </span><span class="dv">1</span>   , <span class="dv">2</span>     , <span class="dv">2008</span>  , <span class="dv">22</span>    , <span class="dv">22</span>      , <span class="dv">24</span>       <span class="op">|</span>
<span class="st">     </span><span class="dv">1</span>   , <span class="dv">2</span>     , <span class="dv">2009</span>  , <span class="dv">10</span>    , <span class="dv">14</span>      , <span class="dv">20</span>       <span class="op">|</span>
<span class="st">     </span><span class="dv">2</span>   , <span class="dv">1</span>     , <span class="dv">2008</span>  , <span class="dv">12</span>    , <span class="dv">13</span>      , <span class="dv">25</span>       <span class="op">|</span>
<span class="st">     </span><span class="dv">2</span>   , <span class="dv">1</span>     , <span class="dv">2009</span>  , <span class="dv">16</span>    , <span class="dv">14</span>      , <span class="dv">21</span>       <span class="op">|</span>
<span class="st">     </span><span class="dv">2</span>   , <span class="dv">2</span>     , <span class="dv">2008</span>  , <span class="dv">13</span>    , <span class="dv">11</span>      , <span class="dv">29</span>       <span class="op">|</span>
<span class="st">     </span><span class="dv">2</span>   , <span class="dv">2</span>     , <span class="dv">2009</span>  , <span class="dv">23</span>    , <span class="dv">20</span>      , <span class="dv">26</span>       <span class="op">|</span>
<span class="st">     </span><span class="dv">3</span>   , <span class="dv">1</span>     , <span class="dv">2008</span>  , <span class="dv">11</span>    , <span class="dv">12</span>      , <span class="dv">22</span>       <span class="op">|</span>
<span class="st">     </span><span class="dv">3</span>   , <span class="dv">1</span>     , <span class="dv">2009</span>  , <span class="dv">13</span>    , <span class="dv">11</span>      , <span class="dv">27</span>       <span class="op">|</span>
<span class="st">     </span><span class="dv">3</span>   , <span class="dv">2</span>     , <span class="dv">2008</span>  , <span class="dv">17</span>    , <span class="dv">12</span>      , <span class="dv">23</span>       <span class="op">|</span>
<span class="st">     </span><span class="dv">3</span>   , <span class="dv">2</span>     , <span class="dv">2009</span>  , <span class="dv">14</span>    ,  <span class="dv">9</span>      , <span class="dv">31</span>       )

<span class="co"># apply the layout</span>
grades <span class="op">%.&gt;%</span><span class="st"> </span>
<span class="st">  </span>layout <span class="op">%.&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(.)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="right">Year</th>
<th align="left">Semester</th>
<th align="right">Test1</th>
<th align="right">Test2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2008</td>
<td align="left">Fall</td>
<td align="right">15</td>
<td align="right">22</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2008</td>
<td align="left">Spring</td>
<td align="right">16</td>
<td align="right">22</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">2008</td>
<td align="left">Winter</td>
<td align="right">19</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2009</td>
<td align="left">Fall</td>
<td align="right">12</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">2009</td>
<td align="left">Spring</td>
<td align="right">13</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2009</td>
<td align="left">Winter</td>
<td align="right">27</td>
<td align="right">20</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">2008</td>
<td align="left">Fall</td>
<td align="right">12</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2008</td>
<td align="left">Spring</td>
<td align="right">13</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">2008</td>
<td align="left">Winter</td>
<td align="right">25</td>
<td align="right">29</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2009</td>
<td align="left">Fall</td>
<td align="right">16</td>
<td align="right">23</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">2009</td>
<td align="left">Spring</td>
<td align="right">14</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2009</td>
<td align="left">Winter</td>
<td align="right">21</td>
<td align="right">26</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2008</td>
<td align="left">Fall</td>
<td align="right">11</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">2008</td>
<td align="left">Spring</td>
<td align="right">12</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2008</td>
<td align="left">Winter</td>
<td align="right">22</td>
<td align="right">23</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">2009</td>
<td align="left">Fall</td>
<td align="right">13</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2009</td>
<td align="left">Spring</td>
<td align="right">11</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">2009</td>
<td align="left">Winter</td>
<td align="right">27</td>
<td align="right">31</td>
</tr>
</tbody>
</table>
</div>
<div id="example-3" class="section level1">
<h1 class="hasAnchor">
<a href="#example-3" class="anchor"></a>Example 3</h1>
<p>(From: <a href="https://github.com/tidyverse/tidyr/blob/master/demo/so-16032858.R" class="uri">https://github.com/tidyverse/tidyr/blob/master/demo/so-16032858.R</a> , <a href="http://stackoverflow.com/questions/16032858" class="uri">http://stackoverflow.com/questions/16032858</a>.)</p>
<p>Question: given data such as below how does one move treatment and control values for each individual into columns? Or how does one take <code>a</code> to <code>b</code>?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/build_frame">build_frame</a></span>(
   <span class="st">"Ind"</span>   , <span class="st">"Treatment"</span>, <span class="st">"value"</span> <span class="op">|</span>
<span class="st">     "Ind1"</span>, <span class="st">"Treat"</span>    , <span class="dv">1</span>       <span class="op">|</span>
<span class="st">     "Ind2"</span>, <span class="st">"Treat"</span>    , <span class="dv">2</span>       <span class="op">|</span>
<span class="st">     "Ind1"</span>, <span class="st">"Cont"</span>     , <span class="dv">3</span>       <span class="op">|</span>
<span class="st">     "Ind2"</span>, <span class="st">"Cont"</span>     , <span class="dv">4</span>       )

b &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/build_frame">build_frame</a></span>(
   <span class="st">"Ind"</span>   , <span class="st">"Treat"</span> , <span class="st">"Cont"</span><span class="op">|</span>
<span class="st">     "Ind1"</span>, <span class="dv">1</span>       , <span class="dv">3</span>     <span class="op">|</span>
<span class="st">     "Ind2"</span>, <span class="dv">2</span>       , <span class="dv">4</span>     )</code></pre></div>
<p>The <code>cdata</code> solution is as follows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"cdata"</span>)

<span class="co"># how to find records</span>
recordKeys &lt;-<span class="st"> "Ind"</span>

<span class="co"># specify the incoming record shape</span>
incoming_record &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/qchar_frame">qchar_frame</a></span>(
   <span class="st">"Treatment"</span>  , <span class="st">"value"</span> <span class="op">|</span>
<span class="st">    "Treat"</span>     , Treat   <span class="op">|</span>
<span class="st">    "Cont"</span>      , Cont    )


<span class="co"># put it all together into a layout</span>
layout &lt;-<span class="st"> </span><span class="kw"><a href="../reference/blocks_to_rowrecs_spec.html">blocks_to_rowrecs_spec</a></span>(
  incoming_record,
  <span class="dt">recordKeys =</span> recordKeys)

<span class="co"># confirm we have the right layout</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(layout)
<span class="co">#&gt; {</span>
<span class="co">#&gt;  block_record &lt;- wrapr::qchar_frame(</span>
<span class="co">#&gt;    "Ind"  , "Treatment", "value" |</span>
<span class="co">#&gt;      .    , "Treat"    , Treat   |</span>
<span class="co">#&gt;      .    , "Cont"     , Cont    )</span>
<span class="co">#&gt;  block_keys &lt;- c('Ind', 'Treatment')</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  # becomes</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  row_record &lt;- wrapr::qchar_frame(</span>
<span class="co">#&gt;    "Ind"  , "Treat", "Cont" |</span>
<span class="co">#&gt;      .    , Treat  , Cont   )</span>
<span class="co">#&gt;  row_keys &lt;- c('Ind')</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  # args: c(checkNames = TRUE, checkKeys = TRUE, strict = FALSE, allow_rqdatatable = FALSE)</span>
<span class="co">#&gt; }</span>

<span class="co"># apply the layout</span>
a <span class="op">%.&gt;%</span><span class="st"> </span>
<span class="st">  </span>layout <span class="op">%.&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(.)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Ind</th>
<th align="right">Treat</th>
<th align="right">Cont</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Ind1</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Ind2</td>
<td align="right">2</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<p>By now you should be able to see the <code>cdata</code> solution always follows a very similar path. In fact we try not to let the nature of the data layout transform (“easy” versus “hard”) dictate the solution method. Always slow down and draw out the before and after before attempting to solve the problem. An interesting trivial transform that was a pain to initially draw-out was converting a typical confusion matrix format (example <a href="https://github.com/WinVector/cdata/blob/master/extras/table/table.md">here</a>).</p>
</div>
<div id="example-4" class="section level1">
<h1 class="hasAnchor">
<a href="#example-4" class="anchor"></a>Example 4</h1>
<p>(From: <a href="https://github.com/tidyverse/tidyr/blob/master/demo/so-17481212.R" class="uri">https://github.com/tidyverse/tidyr/blob/master/demo/so-17481212.R</a> , <a href="http://stackoverflow.com/questions/17481212" class="uri">http://stackoverflow.com/questions/17481212</a>.)</p>
<p>Convert data that has one different observation for each column to a data that has all observations in rows. That is take <code>a</code> to <code>b</code> in the following.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/build_frame">build_frame</a></span>(
   <span class="st">"Name"</span>   , <span class="st">"50"</span>, <span class="st">"100"</span>, <span class="st">"150"</span>, <span class="st">"200"</span>, <span class="st">"250"</span>, <span class="st">"300"</span>, <span class="st">"350"</span> <span class="op">|</span>
<span class="st">     "Carla"</span>, <span class="fl">1.2</span> , <span class="fl">1.8</span>  , <span class="fl">2.2</span>  , <span class="fl">2.3</span>  , <span class="dv">3</span>    , <span class="fl">2.5</span>  , <span class="fl">1.8</span>   <span class="op">|</span>
<span class="st">     "Mace"</span> , <span class="fl">1.5</span> , <span class="fl">1.1</span>  , <span class="fl">1.9</span>  , <span class="dv">2</span>    , <span class="fl">3.6</span>  , <span class="dv">3</span>    , <span class="fl">2.5</span>   )

b &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/build_frame">build_frame</a></span>(
   <span class="st">"Name"</span>   , <span class="st">"Time"</span>, <span class="st">"Score"</span> <span class="op">|</span>
<span class="st">     "Carla"</span>, <span class="dv">50</span>    , <span class="fl">1.2</span>     <span class="op">|</span>
<span class="st">     "Carla"</span>, <span class="dv">100</span>   , <span class="fl">1.8</span>     <span class="op">|</span>
<span class="st">     "Carla"</span>, <span class="dv">150</span>   , <span class="fl">2.2</span>     <span class="op">|</span>
<span class="st">     "Carla"</span>, <span class="dv">200</span>   , <span class="fl">2.3</span>     <span class="op">|</span>
<span class="st">     "Carla"</span>, <span class="dv">250</span>   , <span class="dv">3</span>       <span class="op">|</span>
<span class="st">     "Carla"</span>, <span class="dv">300</span>   , <span class="fl">2.5</span>     <span class="op">|</span>
<span class="st">     "Carla"</span>, <span class="dv">350</span>   , <span class="fl">1.8</span>     <span class="op">|</span>
<span class="st">     "Mace"</span> , <span class="dv">50</span>    , <span class="fl">1.5</span>     <span class="op">|</span>
<span class="st">     "Mace"</span> , <span class="dv">100</span>   , <span class="fl">1.1</span>     <span class="op">|</span>
<span class="st">     "Mace"</span> , <span class="dv">150</span>   , <span class="fl">1.9</span>     <span class="op">|</span>
<span class="st">     "Mace"</span> , <span class="dv">200</span>   , <span class="dv">2</span>       <span class="op">|</span>
<span class="st">     "Mace"</span> , <span class="dv">250</span>   , <span class="fl">3.6</span>     <span class="op">|</span>
<span class="st">     "Mace"</span> , <span class="dv">300</span>   , <span class="dv">3</span>       <span class="op">|</span>
<span class="st">     "Mace"</span> , <span class="dv">350</span>   , <span class="fl">2.5</span>     )</code></pre></div>
<p>The <code>cdata</code> solution is as before, but as we have a large number of columns we will us a helper function to specify the data layout transform.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"cdata"</span>)

<span class="co"># how to find records</span>
recordKeys &lt;-<span class="st"> "Name"</span>

<span class="co"># specify the outgoing record shape, using a helper function</span>
outgoing_record &lt;-<span class="st"> </span><span class="kw"><a href="../reference/build_unpivot_control.html">build_unpivot_control</a></span>(
  <span class="dt">nameForNewKeyColumn =</span> <span class="st">"Time"</span>,
  <span class="dt">nameForNewValueColumn =</span> <span class="st">"Score"</span>,
  <span class="dt">columnsToTakeFrom =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sets">setdiff</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(a), recordKeys))

<span class="co"># put it all together into a layout</span>
layout &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rowrecs_to_blocks_spec.html">rowrecs_to_blocks_spec</a></span>(
  outgoing_record,
  <span class="dt">recordKeys =</span> recordKeys)

<span class="co"># confirm we have the right layout</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(layout)
<span class="co">#&gt; {</span>
<span class="co">#&gt;  row_record &lt;- wrapr::qchar_frame(</span>
<span class="co">#&gt;    "Name"  , "50", "100", "150", "200", "250", "300", "350" |</span>
<span class="co">#&gt;      .     , 50  , 100  , 150  , 200  , 250  , 300  , 350   )</span>
<span class="co">#&gt;  row_keys &lt;- c('Name')</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  # becomes</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  block_record &lt;- wrapr::qchar_frame(</span>
<span class="co">#&gt;    "Name"  , "Time", "Score" |</span>
<span class="co">#&gt;      .     , "50"  , 50      |</span>
<span class="co">#&gt;      .     , "100" , 100     |</span>
<span class="co">#&gt;      .     , "150" , 150     |</span>
<span class="co">#&gt;      .     , "200" , 200     |</span>
<span class="co">#&gt;      .     , "250" , 250     |</span>
<span class="co">#&gt;      .     , "300" , 300     |</span>
<span class="co">#&gt;      .     , "350" , 350     )</span>
<span class="co">#&gt;  block_keys &lt;- c('Name', 'Time')</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  # args: c(checkNames = TRUE, checkKeys = FALSE, strict = FALSE, allow_rqdatatable = TRUE)</span>
<span class="co">#&gt; }</span>

<span class="co"># apply the layout</span>
a <span class="op">%.&gt;%</span><span class="st"> </span>
<span class="st">  </span>layout <span class="op">%.&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/transform">transform</a></span>(., <span class="dt">Time =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(Time)) <span class="op">%.&gt;%</span>
<span class="st">  </span>.[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/order">order</a></span>(.<span class="op">$</span>Name, .<span class="op">$</span>Time), , drop =<span class="st"> </span><span class="ot">FALSE</span>] <span class="op">%.&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(.)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="left">Name</th>
<th align="right">Time</th>
<th align="right">Score</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td align="left">Carla</td>
<td align="right">50</td>
<td align="right">1.2</td>
</tr>
<tr class="even">
<td>3</td>
<td align="left">Carla</td>
<td align="right">100</td>
<td align="right">1.8</td>
</tr>
<tr class="odd">
<td>5</td>
<td align="left">Carla</td>
<td align="right">150</td>
<td align="right">2.2</td>
</tr>
<tr class="even">
<td>7</td>
<td align="left">Carla</td>
<td align="right">200</td>
<td align="right">2.3</td>
</tr>
<tr class="odd">
<td>9</td>
<td align="left">Carla</td>
<td align="right">250</td>
<td align="right">3.0</td>
</tr>
<tr class="even">
<td>11</td>
<td align="left">Carla</td>
<td align="right">300</td>
<td align="right">2.5</td>
</tr>
<tr class="odd">
<td>13</td>
<td align="left">Carla</td>
<td align="right">350</td>
<td align="right">1.8</td>
</tr>
<tr class="even">
<td>2</td>
<td align="left">Mace</td>
<td align="right">50</td>
<td align="right">1.5</td>
</tr>
<tr class="odd">
<td>4</td>
<td align="left">Mace</td>
<td align="right">100</td>
<td align="right">1.1</td>
</tr>
<tr class="even">
<td>6</td>
<td align="left">Mace</td>
<td align="right">150</td>
<td align="right">1.9</td>
</tr>
<tr class="odd">
<td>8</td>
<td align="left">Mace</td>
<td align="right">200</td>
<td align="right">2.0</td>
</tr>
<tr class="even">
<td>10</td>
<td align="left">Mace</td>
<td align="right">250</td>
<td align="right">3.6</td>
</tr>
<tr class="odd">
<td>12</td>
<td align="left">Mace</td>
<td align="right">300</td>
<td align="right">3.0</td>
</tr>
<tr class="even">
<td>14</td>
<td align="left">Mace</td>
<td align="right">350</td>
<td align="right">2.5</td>
</tr>
</tbody>
</table>
</div>
<div id="example-5" class="section level1">
<h1 class="hasAnchor">
<a href="#example-5" class="anchor"></a>Example 5</h1>
<p>(From: <a href="https://github.com/tidyverse/tidyr/blob/master/demo/so-9684671.R" class="uri">https://github.com/tidyverse/tidyr/blob/master/demo/so-9684671.R</a> , <a href="http://stackoverflow.com/questions/9684671" class="uri">http://stackoverflow.com/questions/9684671</a>.)</p>
<p>Convert from <code>a</code> to <code>b</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/build_frame">build_frame</a></span>(
   <span class="st">"id"</span>    , <span class="st">"trt"</span>, <span class="st">"work.T1"</span>, <span class="st">"play.T1"</span>, <span class="st">"talk.T1"</span>, <span class="st">"total.T1"</span>, <span class="st">"work.T2"</span>, <span class="st">"play.T2"</span>, <span class="st">"talk.T2"</span>, <span class="st">"total.T2"</span> <span class="op">|</span>
<span class="st">     "x1.1"</span>, <span class="st">"cnt"</span>, <span class="fl">0.3443</span>   , <span class="fl">0.7842</span>   , <span class="fl">0.1079</span>   , <span class="fl">0.888</span>     , <span class="fl">0.6484</span>   , <span class="fl">0.8795</span>   , <span class="fl">0.7234</span>   , <span class="fl">0.5631</span>     <span class="op">|</span>
<span class="st">     "x1.2"</span>, <span class="st">"tr"</span> , <span class="fl">0.06132</span>  , <span class="fl">0.8427</span>   , <span class="fl">0.3339</span>   , <span class="fl">0.04686</span>   , <span class="fl">0.2348</span>   , <span class="fl">0.1971</span>   , <span class="fl">0.5164</span>   , <span class="fl">0.7618</span>     )

b &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/build_frame">build_frame</a></span>(
   <span class="st">"id"</span>    , <span class="st">"trt"</span>, <span class="st">"time"</span>, <span class="st">"work"</span> , <span class="st">"play"</span>, <span class="st">"talk"</span>, <span class="st">"total"</span> <span class="op">|</span>
<span class="st">     "x1.1"</span>, <span class="st">"cnt"</span>, <span class="st">"T1"</span>  , <span class="fl">0.3443</span> , <span class="fl">0.7842</span>, <span class="fl">0.1079</span>, <span class="fl">0.888</span>   <span class="op">|</span>
<span class="st">     "x1.1"</span>, <span class="st">"cnt"</span>, <span class="st">"T2"</span>  , <span class="fl">0.6484</span> , <span class="fl">0.8795</span>, <span class="fl">0.7234</span>, <span class="fl">0.5631</span>  <span class="op">|</span>
<span class="st">     "x1.2"</span>, <span class="st">"tr"</span> , <span class="st">"T1"</span>  , <span class="fl">0.06132</span>, <span class="fl">0.8427</span>, <span class="fl">0.3339</span>, <span class="fl">0.04686</span> <span class="op">|</span>
<span class="st">     "x1.2"</span>, <span class="st">"tr"</span> , <span class="st">"T2"</span>  , <span class="fl">0.2348</span> , <span class="fl">0.1971</span>, <span class="fl">0.5164</span>, <span class="fl">0.7618</span>  )</code></pre></div>
<p>We can see what cell corresponds in <code>a</code> corresponds to a given cell in <code>b</code> by comparing values.</p>
<p>That <code>cdata</code> solution is, as always, just picking more informative names for these cells.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"cdata"</span>)

<span class="co"># how to find records</span>
recordKeys &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"id"</span>, <span class="st">"trt"</span>)

<span class="co"># specify the outgoing record shape, using a helper function</span>
outgoing_record &lt;-<span class="st"> </span>wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/qchar_frame">qchar_frame</a></span>(
    <span class="st">"time"</span>  , <span class="st">"work"</span> , <span class="st">"play"</span> , <span class="st">"talk"</span> , <span class="st">"total"</span>  <span class="op">|</span>
<span class="st">    "T1"</span>    , work.T1, play.T1, talk.T1, total.T1 <span class="op">|</span>
<span class="st">    "T2"</span>    , work.T2, play.T2, talk.T2, total.T2 )

<span class="co"># put it all together into a layout</span>
layout &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rowrecs_to_blocks_spec.html">rowrecs_to_blocks_spec</a></span>(
  outgoing_record,
  <span class="dt">recordKeys =</span> recordKeys)

<span class="co"># confirm we have the right layout</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(layout)
<span class="co">#&gt; {</span>
<span class="co">#&gt;  row_record &lt;- wrapr::qchar_frame(</span>
<span class="co">#&gt;    "id"  , "trt", "work.T1", "work.T2", "play.T1", "play.T2", "talk.T1", "talk.T2", "total.T1", "total.T2" |</span>
<span class="co">#&gt;      .   , .    , work.T1  , work.T2  , play.T1  , play.T2  , talk.T1  , talk.T2  , total.T1  , total.T2   )</span>
<span class="co">#&gt;  row_keys &lt;- c('id', 'trt')</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  # becomes</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  block_record &lt;- wrapr::qchar_frame(</span>
<span class="co">#&gt;    "id"  , "trt", "time", "work" , "play" , "talk" , "total"  |</span>
<span class="co">#&gt;      .   , .    , "T1"  , work.T1, play.T1, talk.T1, total.T1 |</span>
<span class="co">#&gt;      .   , .    , "T2"  , work.T2, play.T2, talk.T2, total.T2 )</span>
<span class="co">#&gt;  block_keys &lt;- c('id', 'trt', 'time')</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  # args: c(checkNames = TRUE, checkKeys = FALSE, strict = FALSE, allow_rqdatatable = TRUE)</span>
<span class="co">#&gt; }</span>

<span class="co"># apply the layout</span>
a <span class="op">%.&gt;%</span><span class="st"> </span>
<span class="st">  </span>layout <span class="op">%.&gt;%</span>
<span class="st">  </span>.[wrapr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/orderv">orderv</a></span>(.[ , recordKeys, <span class="dt">drop =</span> <span class="ot">FALSE</span>]), , drop =<span class="st"> </span><span class="ot">FALSE</span>] <span class="op">%.&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(.)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">id</th>
<th align="left">trt</th>
<th align="left">time</th>
<th align="right">work</th>
<th align="right">play</th>
<th align="right">talk</th>
<th align="right">total</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">x1.1</td>
<td align="left">cnt</td>
<td align="left">T1</td>
<td align="right">0.34430</td>
<td align="right">0.7842</td>
<td align="right">0.1079</td>
<td align="right">0.88800</td>
</tr>
<tr class="even">
<td align="left">x1.1</td>
<td align="left">cnt</td>
<td align="left">T2</td>
<td align="right">0.64840</td>
<td align="right">0.8795</td>
<td align="right">0.7234</td>
<td align="right">0.56310</td>
</tr>
<tr class="odd">
<td align="left">x1.2</td>
<td align="left">tr</td>
<td align="left">T1</td>
<td align="right">0.06132</td>
<td align="right">0.8427</td>
<td align="right">0.3339</td>
<td align="right">0.04686</td>
</tr>
<tr class="even">
<td align="left">x1.2</td>
<td align="left">tr</td>
<td align="left">T2</td>
<td align="right">0.23480</td>
<td align="right">0.1971</td>
<td align="right">0.5164</td>
<td align="right">0.76180</td>
</tr>
</tbody>
</table>
<div id="transform-direction" class="section level2">
<h2 class="hasAnchor">
<a href="#transform-direction" class="anchor"></a>Transform Direction</h2>
<p><code>cdata</code> transforms specifications are reversible or invertible. So in solving any one of the above problems the user has complete freedom to try and solve “moving from a to b” or “moving form b to a” (and can pick whichever they find easier).</p>
<p>For example continuing with example 5, we can reverse the data layout transform using the <code><a href="https://www.rdocumentation.org/packages/base/topics/t">t()</a></code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">inv_layout &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(layout)

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(inv_layout)
<span class="co">#&gt; {</span>
<span class="co">#&gt;  block_record &lt;- wrapr::qchar_frame(</span>
<span class="co">#&gt;    "id"  , "trt", "time", "work" , "play" , "talk" , "total"  |</span>
<span class="co">#&gt;      .   , .    , "T1"  , work.T1, play.T1, talk.T1, total.T1 |</span>
<span class="co">#&gt;      .   , .    , "T2"  , work.T2, play.T2, talk.T2, total.T2 )</span>
<span class="co">#&gt;  block_keys &lt;- c('id', 'trt', 'time')</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  # becomes</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  row_record &lt;- wrapr::qchar_frame(</span>
<span class="co">#&gt;    "id"  , "trt", "work.T1", "work.T2", "play.T1", "play.T2", "talk.T1", "talk.T2", "total.T1", "total.T2" |</span>
<span class="co">#&gt;      .   , .    , work.T1  , work.T2  , play.T1  , play.T2  , talk.T1  , talk.T2  , total.T1  , total.T2   )</span>
<span class="co">#&gt;  row_keys &lt;- c('id', 'trt')</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  # args: c(checkNames = TRUE, checkKeys = FALSE, strict = FALSE, allow_rqdatatable = TRUE)</span>
<span class="co">#&gt; }</span>

<span class="co"># apply the inverse layout</span>
b <span class="op">%.&gt;%</span><span class="st"> </span>
<span class="st">  </span>inv_layout <span class="op">%.&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(.)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">id</th>
<th align="left">trt</th>
<th align="right">work.T1</th>
<th align="right">work.T2</th>
<th align="right">play.T1</th>
<th align="right">play.T2</th>
<th align="right">talk.T1</th>
<th align="right">talk.T2</th>
<th align="right">total.T1</th>
<th align="right">total.T2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">x1.1</td>
<td align="left">cnt</td>
<td align="right">0.34430</td>
<td align="right">0.6484</td>
<td align="right">0.7842</td>
<td align="right">0.8795</td>
<td align="right">0.1079</td>
<td align="right">0.7234</td>
<td align="right">0.88800</td>
<td align="right">0.5631</td>
</tr>
<tr class="even">
<td align="left">x1.2</td>
<td align="left">tr</td>
<td align="right">0.06132</td>
<td align="right">0.2348</td>
<td align="right">0.8427</td>
<td align="right">0.1971</td>
<td align="right">0.3339</td>
<td align="right">0.5164</td>
<td align="right">0.04686</td>
<td align="right">0.7618</td>
</tr>
</tbody>
</table>
<p>(We may get a different column order or row order. In <code>cdata</code> row and column order are not considered essential properties of the data layout transform (as is also the the case with relational data systems).)</p>
</div>
<div id="package-entry-points" class="section level2">
<h2 class="hasAnchor">
<a href="#package-entry-points" class="anchor"></a>Package entry points</h2>
<p>The main <code>cdata</code> interfaces are given by the following set of methods:</p>
<ul>
<li>
<a href="https://winvector.github.io/cdata/reference/pivot_to_rowrecs.html"><code><a href="../reference/pivot_to_rowrecs.html">pivot_to_rowrecs()</a></code></a>, a convenience function for moving data from multi-row block records with one value per row to single row records.</li>
<li>
<a href="https://winvector.github.io/cdata/reference/unpivot_to_blocks.html"><code><a href="../reference/unpivot_to_blocks.html">unpivot_to_blocks()</a></code></a>, a convenience function for moving data from single-row records to possibly multi row block records with one row per value.</li>
<li>
<a href="https://winvector.github.io/cdata/reference/rowrecs_to_blocks_spec.html"><code><a href="../reference/rowrecs_to_blocks_spec.html">rowrecs_to_blocks_spec()</a></code></a>, for specifying how single row records relate to general multi-row (or block) records.</li>
<li>
<a href="https://winvector.github.io/cdata/reference/blocks_to_rowrecs_spec.html"><code><a href="../reference/blocks_to_rowrecs_spec.html">blocks_to_rowrecs_spec()</a></code></a>, for specifying how multi-row block records relate to single-row records.</li>
<li>
<a href="https://winvector.github.io/cdata/reference/layout_by.html"><code><a href="../reference/layout_by.html">layout_by()</a></code></a> or the <a href="https://winvector.github.io/wrapr/reference/dot_arrow.html">wrapr dot arrow pipe</a> for applying a layout to re-arrange data.</li>
<li>
<code><a href="https://www.rdocumentation.org/packages/base/topics/t">t()</a></code> (transpose/adjoint) to invert or reverse layout specifications.</li>
<li>
<a href="https://winvector.github.io/wrapr/reference/qchar_frame.html"><code><a href="https://www.rdocumentation.org/packages/wrapr/topics/qchar_frame">wrapr::qchar_frame()</a></code></a> a helper in specifying record control table layout specifications.</li>
<li>
<a href="https://winvector.github.io/cdata/reference/layout_specification.html"><code><a href="../reference/layout_specification.html">layout_specification()</a></code></a>, for specifying transforms from multi-row records to other multi-row records.</li>
</ul>
<p>The package vignettes can be found in the “Articles” tab <a href="https://winvector.github.io/cdata/">here</a>.</p>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>Notice how in all cases we can solve the record layout transform by insisting an an example of the incoming and outgoing records, knowing which columns specify records (<code>recordKeys</code>) and then copying column names from the incoming/outgoing records into cells of the outgoing/incoming records. Really all one is doing when using <code>cdata</code> is formalizing the transform “ask” into a machine readable example.</p>
<p>To make your own solutions, we suggest just using one of these solutions as a template. The idea of having the data layout transform be simple data (a <code>list</code> of a couple of <code>data.frame</code>s) means one can use the full power of <code>R</code> and other <code>R</code> packages to build the data layout transform specification (one isn’t limited to some interface grammar specified by the data layout transform package). The idea of using arbitrary code to build up a data layout transform was used to good end in the grid scatter-plot example <a href="https://github.com/WinVector/cdata">here</a>.</p>
<p><code>cdata</code> also supplies a number of convenience functions for specifying common transforms,</p>
<p>We also note the value of being able to print and review the bulk of data layout transform, as it documents expected incoming data columns and interior block record key values.</p>
<p>The source-code for <a href="https://winvector.github.io/cdata/articles/exercises.html">this note</a> can be found <a href="https://github.com/WinVector/cdata/blob/master/vignettes/exercises.Rmd">here</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#example-1">Example 1</a></li>
      <li><a href="#example-2">Example 2</a></li>
      <li><a href="#example-3">Example 3</a></li>
      <li><a href="#example-4">Example 4</a></li>
      <li>
<a href="#example-5">Example 5</a><ul class="nav nav-pills nav-stacked">
<li><a href="#transform-direction">Transform Direction</a></li>
      <li><a href="#package-entry-points">Package entry points</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by John Mount, Nina Zumel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
